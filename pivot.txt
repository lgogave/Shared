USE [RPDB]
GO
/****** Object:  StoredProcedure [dbo].[GetSchAdhDashboardByAgent]    Script Date: 10/28/2024 5:32:44 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


ALTER PROCEDURE [dbo].[GetSchAdhDashboardByAgent]
@Month SMALLINT = NULL,
@Year SMALLINT = NULL,
@LOB VARCHAR(MAX)=NULL,
@Location VARCHAR(MAX)=NULL,
@Superwisor VARCHAR(MAX)=NULL,
@Agent VARCHAR(MAX)=NULL,
@ProdStatus VARCHAR(MAX)=NULL
AS 
BEGIN
	SELECT  top 20 [Name] AS Agent,SUM(Actual_Duration)/Sum(Scheduled_Duration) * 100 AS SchAdh  
	FROM [dbo].TranSchAdhWex
	WHERE ReportMonth=@Month AND ReportYear=@Year 
	AND (@LOB IS NULL OR LOB IN (select CAST(Item AS nvarchar(max)) from dbo.SplitString(@LOB, ',')))
	AND (@Location IS NULL OR [Location] IN (select CAST(Item AS nvarchar(max)) from dbo.SplitString(@Location, ',')))
	AND (@Superwisor IS NULL OR [Supervisor] IN (select CAST(Item AS nvarchar(max)) from dbo.SplitString(@Superwisor, ',')))
	AND (@Agent IS NULL OR [Name] IN (select CAST(Item AS nvarchar(max)) from dbo.SplitString(@Agent, ',')))
	AND (@ProdStatus IS NULL OR [Production Status] IN (select CAST(Item AS nvarchar(max)) from dbo.SplitString(@ProdStatus, ',')))
	GROUP BY [Name] Order by SUM(Actual_Duration)/Sum(Scheduled_Duration) * 100  asc
END
